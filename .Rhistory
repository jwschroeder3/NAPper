library(tidyverse)
srcdir = 'src'
file.path(srcdir, 'helper_functions.R')
source(file.path(srcdir,'helper_functions.R'))
data_tib = tibble(direc = bact_direcs)
bact_direcs = c(
'Bs', # Bacillus subtilis
'Mtb', # Mycobacterium tuberculosis
'Ec', # Escherichia coli
'Pa', # Pseudomonas aeruginosa
'Nm', # Nisseria meningitidis
'Cc' # Caulobacter crescentus
)
data_tib = tibble(direc = bact_direcs)
list.files('Bs')
library(tidyverse)
library(ggrepel)
bact_direcs = c(
'Bs', # Bacillus subtilis
'Mtb', # Mycobacterium tuberculosis
'Ec', # Escherichia coli
'Pa', # Pseudomonas aeruginosa
'Nm', # Nisseria meningitidis
'Cc' # Caulobacter crescentus
)
data_tib = tibble(direc = bact_direcs) %>%
mutate(hits = purrr::map(file.path(bact_direcs, 'nap_hits_full.txt'), read_tsv))
(data_tib %>%
filter(direc=="Bs") %>%
.$hits)[[1]] %>%
mutate(logTPM_8h = log2(`8h_average_tpm.txt`),
logTPM_24h = log2(`24h_average_tpm.txt`)) %>%
arrange(desc(logTPM_8h)) %>%
write_tsv(file="Bs_results.txt")
(data_tib %>%
filter(direc=="Ec") %>%
.$hits)[[1]] %>%
mutate(logTPM_control = log2(`control_average_tpm.txt`),
logTPM_stat = log2(`stat_average_tpm.txt`)) %>%
arrange(desc(logTPM_control)) %>%
write_tsv(file="Ec_results.txt")
(data_tib %>%
filter(direc=="Nm") %>%
.$hits)[[1]] %>%
mutate(logTPM_control = log2(`control_average_tpm.txt`),
logTPM_stat = log2(`stat_average_tpm.txt`)) %>%
arrange(desc(logTPM_control)) %>%
write_tsv(file="Nm_results.txt")
(data_tib %>%
filter(direc=="Pa") %>%
.$hits)[[1]] %>%
mutate(logTPM_control = log2(`control_average_tpm.txt`),
logTPM_stat = log2(`stat_average_tpm.txt`)) %>%
arrange(desc(logTPM_control)) %>%
write_tsv(file="Pa_results.txt")
(data_tib %>%
filter(direc=="Cc") %>%
.$hits)[[1]] %>%
mutate(logTPM_wt = log2(`wt_tpm.txt`),
logTPM_gapR_depleted = log2(`gapR_dep_tpm.txt`)) %>%
arrange(desc(logTPM_wt)) %>%
write_tsv(file="Cc_results.txt")
(data_tib %>%
filter(direc=="Mtb") %>%
.$hits)[[1]] %>%
mutate(logTPM_wt = log2(`wt_average_tpm.txt`)) %>%
arrange(desc(logTPM_wt)) %>%
write_tsv(file="Mtb_results.txt")
plot_data = read_tsv('Bs_results_category_supplemented.tsv')
exp_data_8h = read_tsv('Bs/8h_average_tpm.txt')
perc_8h = log2(quantile(exp_data_8h$tpm, c(0.8,0.9)))
exp_data_24h = read_tsv('Bs/24h_average_tpm.txt')
perc_24h = log2(quantile(exp_data_24h$tpm, c(0.8,0.9)))
xmin = 7.3
xmax = 9.7
ymin = 7.8
ymax = 9.1
p = plot_data %>%
ggplot() +
geom_vline(xintercept=perc_24h, linetype='dashed', color='red') +
geom_hline(yintercept=perc_8h, linetype='dashed', color='red') +
geom_point(aes(x=logTPM_24h, y=logTPM_8h, color=category)) +
scale_color_discrete(name="Category", breaks=c("GR","LR","NAP","PNAP","Other"), labels=c("Global regulator", "Local regulator", "NAP", "Potential NAP", "Other")) +
geom_text_repel(aes(x=logTPM_24h, y=logTPM_8h, label=gene), color='black', fontface='italic') +
geom_rect(data=tibble(xl=xmin,xu=xmax,yl=ymin,yu=ymax), aes(xmin=xl, xmax=xu, ymin=yl, ymax=yu), fill="NA", color="black") +
theme_linedraw() +
theme(text=element_text(size=12)) +
labs(x="log2(TPM) 24 hours into biofilm development", y="log2(TPM) 8 hours into biofilm development")
p
inset_p = plot_data %>%
filter(logTPM_24h > xmin,
logTPM_24h < xmax,
logTPM_8h > ymin,
logTPM_8h < ymax) %>%
ggplot(aes(x=logTPM_24h, y=logTPM_8h, color=category)) +
geom_vline(xintercept=perc_24h, linetype='dashed', color='red') +
geom_hline(yintercept=perc_8h, linetype='dashed', color='red') +
geom_point() +
scale_color_discrete(name="Category", breaks=c("GR","LR","NAP","PNAP","Other"), labels=c("Global regulator", "Local regulator", "NAP", "Potential NAP", "Other")) +
geom_text_repel(aes(label=gene), color='black', fontface='italic') +
theme_linedraw() +
theme(text=element_text(size=12)) +
labs(x="log2(TPM) 24 hours into biofilm development", y="log2(TPM) 8 hours into biofilm development")
inset_p
# get percentiles ----
quants = c(0.8,0.9)
cc_perc_wt = log2(quantile(read_tsv('Cc/wt_tpm.txt')$tpm, quants))
library(tidyverse)
cc_perc_wt = log2(quantile(read_tsv('Cc/wt_tpm.txt')$tpm, quants))
cc_perc_wt
# get percentiles ----
get_percs = function(fname,q) {
return(log2(quantile(read_tsv(fname)$tpm, q)))
}
cc_perc_wt = get_percs('Cc/wt_tpm.txt', quants)
get_percs('Cc/wt_tpm.txt', quants)
get_percs('Ec/control_average_tpm.txt', quants)
get_percs('Ec/stat_average_tpm.txt', quants)
bs_perc_8h = get_percs('Bs/8h_average_tpm.txt')
bs_perc_24h = get_percs('Bs/24h_average_tpm.txt')
bs_perc_8h = get_percs('Bs/8h_average_tpm.txt', quants)
bs_perc_24h = get_percs('Bs/24h_average_tpm.txt', quants)
bs_perc_8h
bs_perc_24h
get_percs('Pa/stat_average_tpm.txt', quants)
get_percs('Pa/control_average_tpm.txt', quants)
get_percs('Pa/stat_average_tpm.txt', quants)
get_percs('Nm/control_average_tpm.txt', quants)
get_percs('Nm/stat_average_tpm.txt', quants)
get_percs('Mtb/control_average_tpm.txt', quants)
get_percs('Mtb/wt_average_tpm.txt', quants)
read_tsv('Mtb/wt_average_tpm.txt')
mtb = read_tsv('Mtb/wt_average_tpm.txt')
mtb
percs = NA
for (i in 1:nrow(mtb)) {}
for (i in 1:nrow(mtb)) {
this_tpm = mtb$tpm[i]
percs[i] = length(which(this_tpm > mtb$tpm))/length(mtb$tpm)
}
percs
mtb$perc = percs
mtb
grep('NP_218366', mtb)
grepl('NP_218366', mtb)
grepl('NP_218366', mtb$target_id)
grep('NP_218366', mtb$target_id)
mtb[grep('NP_218366', mtb$target_id),]
# checking Mtb refs of interest ----
mtb = read_tsv('Mtb/wt_average_tpm.txt')
mtb_percs = NA
mtb_percs = NA
for (i in 1:nrow(mtb)) {
this_tpm = mtb$tpm[i]
mtb_percs[i] = length(which(this_tpm > mtb$tpm))/length(mtb$tpm)
}
mtb$perc = mtb_percs
mtb[grep('NP_218366', mtb$target_id),]
#MihF
mtb[grep('NP_215904', mtb$target_id),]
# Rv0047c
mtb[grep('NP_214561', mtb$target_id),]
# Rv3852
mtb[grep('NP_218369', mtb$target_id),]
10**-2
-log10(0.2)
-log10(2)
-log10(3)
-log10(0.05)
-log10(0.2)
